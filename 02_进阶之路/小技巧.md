# 一、几种任务计时器的选择

## 1.Timer

适合执行延迟性的一次型任务，多次点击会重复执行

```java
public class MainActivity extends AppCompatActivity {

    MyTimerTask timer = new MyTimerTask(10 * 1000, 1000);
    int i = 0;
    TextView mTextView;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main2);
        mTextView = findViewById(R.id.tv);
    }

    public void start(View view) {
        timer.start();
    }

    public void stop(View view) {
        timer.cancel();
    }

    class MyTimerTask extends CountDownTimer {
        public MyTimerTask(long millisInFuture, long countDownInterval) {
            super(millisInFuture, countDownInterval);
        }

        //处理每次timer延迟后的消费事件
        @Override
        public void onTick(long millisUntilFinished) {
            mTextView.setText(i + "");
            Log.e("mayue", i + "");
            i++;
        }

        //计时结束所做的事
        @Override
        public void onFinish() {
            i = 0;
            mTextView.setText(i + "");
        }
    }
}
```





## 2.Handler

所有需求均可

```java
public class MainActivity extends AppCompatActivity {
    int i = 0;
    TextView tv;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        tv = findViewById(R.id.tv);
    }

    public void start(View view) {
        i = 0;//需要重置的时候写
        handler.removeMessages(0x01); //不想多次点击出现多个任务的时候写
        handler.sendEmptyMessage(0x01);
    }

    public void stop(View view) {
        handler.removeMessages(0x01);
    }

    private Handler handler = new Handler() {
        @Override
        public void handleMessage(@NonNull Message msg) {
            super.handleMessage(msg);
            if (msg.what == 0x01) {
                tv.setText(i + "");
                i++;
                handler.sendEmptyMessageDelayed(0x01, 1000);
            }
        }
    };
}
```







## 3.线程池

配合Runnable对象和标志位使用：

```java
public class MainActivity extends AppCompatActivity {

    int i = 0;
    TextView tv;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        tv = findViewById(R.id.tv);
    }


    public void start(View view) {
        stop=false;
        i=0;
        ThreadPoolProxyFactory.getCommonThreadPoolProxy().execute(myRunnable);
    }

    public void stop(View view) {
        stop = true;
        ThreadPoolProxyFactory.getCommonThreadPoolProxy().remove(myRunnable);
    }

    boolean stop;  //标志位

    Runnable myRunnable = new Runnable() {
        @Override
        public void run() {
            while (!stop) {
                try {
                    Thread.sleep(1000);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
                runOnUiThread(() -> {
                    tv.setText(i + "");
                    i++;
                    Log.e("mayue", i + "");

                });
            }
        }
    };
}
```









# 二、给progressBar添加改变动画

```java
    private void setAnimation(ProgressBar progressBar, TextView tv_progress, int startProgress, int endProgress) {
        ValueAnimator animator = ValueAnimator.ofInt(startProgress, endProgress).setDuration(500);

        animator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {
            @Override
            public void onAnimationUpdate(ValueAnimator valueAnimator) {
                progressBar.setProgress((int) valueAnimator.getAnimatedValue());
                tv_progress.setText(String.valueOf(valueAnimator.getAnimatedValue()));
            }
        });
        animator.start();
    }
```

```java
    //调用
	int progress;
    public void changeProgress(View view) {
        int endProgress = progress + 10;
        if (endProgress > 100) {
            endProgress = 0;
        }
        setAnimation(mainBinding.progressbar, mainBinding.tv, progress, endProgress);
        progress = endProgress;
    }
```















